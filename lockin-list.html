<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LockIn List - Turn Chaos Into Action</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #16213e 75%, #1a1a2e 100%);
        }
        .card-shadow {
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .neon-glow {
            box-shadow: 0 0 20px rgba(83, 217, 209, 0.3);
        }
        .neon-text {
            text-shadow: 0 0 10px rgba(83, 217, 209, 0.5);
        }
        .gaming-card {
            background: rgba(15, 52, 96, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(83, 217, 209, 0.2);
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
                üîí LockIn List
            </h1>
            <p class="text-xl text-white/90 max-w-2xl mx-auto">
                Turn that annoying block of text into a clear action plan. 
                <span class="font-semibold">What am I supposed to do next?</span> We got you.
            </p>
        </div>

        <!-- Main Card -->
        <div class="max-w-4xl mx-auto gaming-card rounded-2xl card-shadow overflow-hidden neon-glow">
            <!-- Input Section -->
            <div class="p-8 border-b border-gray-700">
                <h2 class="text-2xl font-semibold text-white mb-4 neon-text">
                    üìß Paste Your Block of Text Here
                </h2>
                <textarea 
                    id="inputText" 
                    placeholder="Paste your teacher's email, assignment description, or project brief... We'll break it down for you! üéØ"
                    class="w-full h-40 p-4 border-2 border-gray-600 rounded-xl resize-none focus:border-cyan-400 focus:outline-none transition-colors duration-200 text-white bg-gray-800 placeholder-gray-400"
                ></textarea>
                
                <!-- Action Buttons -->
                <div class="flex gap-4 mt-6">
                    <button 
                        id="lockInBtn" 
                        class="flex-1 bg-gradient-to-r from-cyan-400 to-cyan-500 text-gray-900 font-semibold py-4 px-8 rounded-xl hover:from-cyan-300 hover:to-cyan-400 transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-cyan-300 shadow-lg"
                        style="box-shadow: 0 0 20px rgba(83, 217, 209, 0.4);"
                    >
                        üöÄ Lock In & Get My List
                    </button>
                    <button 
                        id="clearBtn" 
                        class="bg-gray-600 text-white font-semibold py-4 px-6 rounded-xl hover:bg-gray-500 transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-gray-400"
                    >
                        üóëÔ∏è Clear
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden p-8 text-center">
                <div class="flex items-center justify-center space-x-3">
                    <div class="w-6 h-6 bg-cyan-400 rounded-full pulse-animation" style="box-shadow: 0 0 10px rgba(83, 217, 209, 0.6);"></div>
                    <div class="w-6 h-6 bg-lime-400 rounded-full pulse-animation" style="animation-delay: 0.2s; box-shadow: 0 0 10px rgba(249, 255, 76, 0.6);"></div>
                    <div class="w-6 h-6 bg-cyan-300 rounded-full pulse-animation" style="animation-delay: 0.4s; box-shadow: 0 0 10px rgba(83, 217, 209, 0.6);"></div>
                </div>
                <p class="text-cyan-200 mt-4 text-lg">üß† Thinking... Breaking this down for you!</p>
            </div>

            <!-- Output Section -->
            <div id="outputSection" class="hidden">
                <div class="p-8">
                    <h2 class="text-2xl font-semibold text-white mb-6 flex items-center neon-text">
                        ‚úÖ Your Action Plan
                    </h2>
                    <div id="outputContent" class="space-y-6"></div>
                </div>
            </div>

            <!-- Error State -->
            <div id="errorState" class="hidden p-8 text-center">
                <div class="text-red-400 text-6xl mb-4">üòÖ</div>
                <h3 class="text-xl font-semibold text-white mb-2">Oops! Something went wrong</h3>
                <p class="text-gray-300 mb-4">Don't worry, it happens! Try again in a moment.</p>
                <p id="errorMessage" class="text-sm text-gray-400"></p>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8">
            <p class="text-cyan-300/70">
                Made for students who need to crush it üí™ | Powered by AI
            </p>
        </div>
    </div>

    <script>
        // No API key needed on frontend - using secure backend proxy
        
        // DOM elements
        const inputText = document.getElementById('inputText');
        const lockInBtn = document.getElementById('lockInBtn');
        const clearBtn = document.getElementById('clearBtn');
        const loadingState = document.getElementById('loadingState');
        const outputSection = document.getElementById('outputSection');
        const outputContent = document.getElementById('outputContent');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');



        // Event listeners
        lockInBtn.addEventListener('click', processText);
        clearBtn.addEventListener('click', clearAll);
        inputText.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                processText();
            }
        });

        // Functions
        function showLoading() {
            hideAllStates();
            loadingState.classList.remove('hidden');
        }

        function showOutput() {
            hideAllStates();
            outputSection.classList.remove('hidden');
            outputSection.classList.add('fade-in');
        }

        function showError(message) {
            hideAllStates();
            errorState.classList.remove('hidden');
            errorMessage.textContent = message;
        }

        function hideAllStates() {
            loadingState.classList.add('hidden');
            outputSection.classList.add('hidden');
            errorState.classList.add('hidden');
        }

        function clearAll() {
            inputText.value = '';
            hideAllStates();
            inputText.focus();
        }

        async function processText() {
            const text = inputText.value.trim();
            
            if (!text) {
                alert('Please paste some text first! üìù');
                inputText.focus();
                return;
            }

            showLoading();

            try {
                // Call our secure backend API instead of Gemini directly
                const response = await fetch('/api/process-text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Server Error: ${response.status}`);
                }

                const data = await response.json();
                
                displayResult(data.result);
                showOutput();

            } catch (error) {
                console.error('Error:', error);
                showError(error.message || 'Something went wrong. Please try again!');
            }
        }

        function displayResult(result) {
            // Parse and format the AI response
            const lines = result.split('\n').filter(line => line.trim());
            
            // Store sections separately (removed first section)
            const sections = {
                tasks: [],
                due: []
            };
            
            let currentSection = '';

            // Parse all content into sections (skip first step section)
            lines.forEach(line => {
                const trimmedLine = line.trim();
                
                if (trimmedLine.toUpperCase().includes('TASKS:')) {
                    currentSection = 'tasks';
                } else if (trimmedLine.toUpperCase().includes('DUE:')) {
                    currentSection = 'due';
                } else if (trimmedLine.toUpperCase().includes('FIRST STEP:')) {
                    // Skip first step section entirely
                    currentSection = '';
                } else if (trimmedLine.startsWith('*') || trimmedLine.startsWith('-')) {
                    const taskText = trimmedLine.substring(1).trim();
                    if (currentSection && sections[currentSection]) {
                        sections[currentSection].push(taskText);
                    }
                } else if (trimmedLine && currentSection && sections[currentSection]) {
                    // Handle non-bullet points
                    sections[currentSection].push(trimmedLine);
                }
            });

            // Build HTML - Tasks first, then Due Dates
            let formattedHTML = '';

            // 1. Tasks with Copy Button
            if (sections.tasks.length > 0) {
                formattedHTML += '<div id="tasksSection" class="mb-6">';
                formattedHTML += '<div class="flex items-center justify-between mb-3">';
                formattedHTML += '<h3 class="text-lg font-semibold text-white flex items-center"><span class="text-2xl mr-2">üìã</span>Your Tasks</h3>';
                formattedHTML += '<button id="copyTasksBtn" class="bg-gradient-to-r from-lime-400 to-lime-500 text-gray-900 px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200 flex items-center space-x-2 hover:from-lime-300 hover:to-lime-400" style="box-shadow: 0 0 15px rgba(249, 255, 76, 0.4);"><span>üìã</span><span>Copy to Notes</span></button>';
                formattedHTML += '</div>';
                formattedHTML += '<ul id="tasksList" class="space-y-2">';
                sections.tasks.forEach(item => {
                    formattedHTML += `<li class="flex items-start bg-gray-800 bg-opacity-50 p-3 rounded-lg border border-gray-700"><span class="text-cyan-400 font-bold mr-3">‚Ä¢</span><span class="text-gray-200">${item}</span></li>`;
                });
                formattedHTML += '</ul></div>';
            }

            // 2. Due Dates
            if (sections.due.length > 0) {
                formattedHTML += '<div class="mb-6"><h3 class="text-lg font-semibold text-white mb-3 flex items-center"><span class="text-2xl mr-2">‚è∞</span>Due Dates</h3><ul class="space-y-2">';
                sections.due.forEach(item => {
                    formattedHTML += `<li class="flex items-start bg-gray-800 bg-opacity-50 p-3 rounded-lg border border-gray-700"><span class="text-lime-400 font-bold mr-3">‚Ä¢</span><span class="text-gray-200">${item}</span></li>`;
                });
                formattedHTML += '</ul></div>';
            }

            outputContent.innerHTML = formattedHTML;

            // Add event listener for copy button
            const copyBtn = document.getElementById('copyTasksBtn');
            if (copyBtn) {
                copyBtn.addEventListener('click', copyTasksToClipboard);
            }
        }

        async function copyTasksToClipboard() {
            const tasksList = document.getElementById('tasksList');
            if (!tasksList) return;

            // Extract text content from tasks list
            const tasks = Array.from(tasksList.querySelectorAll('li')).map(li => {
                const text = li.textContent.trim();
                return `‚Ä¢ ${text.substring(1)}`; // Remove the bullet point character and add our own
            });

            const tasksText = tasks.join('\n');

            try {
                await navigator.clipboard.writeText(tasksText);
                
                // Show feedback
                const copyBtn = document.getElementById('copyTasksBtn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>‚úÖ</span><span>Copied!</span>';
                copyBtn.style.background = 'linear-gradient(to right, #22d3ee, #06b6d4)';
                copyBtn.style.boxShadow = '0 0 15px rgba(34, 211, 238, 0.6)';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = 'linear-gradient(to right, #a3e635, #84cc16)';
                    copyBtn.style.boxShadow = '0 0 15px rgba(249, 255, 76, 0.4)';
                }, 2000);
                
            } catch (err) {
                console.error('Failed to copy: ', err);
                
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = tasksText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Show feedback
                const copyBtn = document.getElementById('copyTasksBtn');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span>‚úÖ</span><span>Copied!</span>';
                copyBtn.style.background = 'linear-gradient(to right, #22d3ee, #06b6d4)';
                copyBtn.style.boxShadow = '0 0 15px rgba(34, 211, 238, 0.6)';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = 'linear-gradient(to right, #a3e635, #84cc16)';
                    copyBtn.style.boxShadow = '0 0 15px rgba(249, 255, 76, 0.4)';
                }, 2000);
            }
        }

        // Initialize
        inputText.focus();
    </script>
</body>
</html>